---
layout: default
author: xfoolish
create: 2016-01-09
title: Ubuntu下MongoDB初级配置
excerpt: <p>Ubuntu下MongoBD的初级配置。</p>
---

<div class="blog-wrapper wrapper">
	<div class="blog">
		<div class="blog-content">
			<h2 class="blog-header"><a href="#">{{ page.title }}</a></h2>

			<div class="blog-meta">
				<span class="date-span"><i class="fa fa-lg fa-clock-o"></i><a href="#">{{ page.create }}</a></span>
			</div>

			<div class="clearfix"></div>

			<div class="main-content">
        <p>MongoDB是一种文档导向型的开源数据库，由C++撰写而成，底层数据以JSON格式存储，是一种比较流行的数据库。这里不对MongoDB本身的优劣进行讨论，关于这个可以参考<a href="http://cryto.net/">CrytoCC</a>的创建者<a href="http://cryto.net/~joepie91/">Sven Slootweg (joepie91)</a>的博文<a href="http://cryto.net/~joepie91/blog/2015/07/19/why-you-should-never-ever-ever-use-mongodb/">《为什么你应该永远、永远、永远不要再使用MongoDB》</a>。在这里我只单纯地介绍MongoDB的配置使用，以求快速上手使用，关于不同数据库的对比和选择我会在其他文章中进行讨论。</p>

        <h1>下载</h1>
        <p>进入MongoBD官网，选择合适的版本进行下载。</p>
        <img src="/img/b2/1.png"/>

        <h1>安装</h1>
        <p>解压下载的MongoDB到对应的目录下，解压后的文件如下：</p>
        <img src="/img/b2/2.png"/>

        <h1>配置</h1>
        <p>解压后MongoDB已经可以直接使用，默认的数据存储在/data/db，而log存储在/var/log/mongodb/mongod.log。启动MongoDB前需要手动创建对应的目录。</p>

        <div class="commands">
				<span class="command"><span class="op">&gt;</span>./bin/mongod</span>
				</div>

        <p>也可以通过命令参数对MongoDB进行配置，例如，指定数据存储目录：</p>
        <div class="commands">
				<span class="command"><span class="op">&gt;</span>./bin/mongod --dbpath ~/Data/mongodb/db</span>
				</div>

        <p>当然，最方便的方法是通过配置文件进行配置，MongoDB配置文件使用<a href="http://www.yaml.org/">YAML</a>格式。可配置的属性请参考<a href="https://docs.mongodb.org/manual/reference/configuration-options/">MongoDB官方文档</a>。本文中我对部分属性进行了配置，创建了配置文件config.yaml，主要对数据和log的存储目录进行了指定。</p>
        <img src="/img/b2/3.png"/>

        <p>使用配置文件进行启动如下，至此MongoDB已经成功启动。</p>
        <div class="commands">
				<span class="command"><span class="op">&gt;</span>./bin/mongod --config config.yaml</span>
				</div>

        <p>关闭MongoDB，可以通过命令pkill来完成。</p>
        <div class="commands">
				<span class="command"><span class="op">&gt;</span>pkill mongod</span>
				</div>

        <h1>创建用户</h1>
        <p>启动后，我们就可以通过mongo对数据库进行管理，mongo是一个mongoDB自带的交互的shell工具。MongoDB默认是不需要身份验证的，因此我们可以本地直接通过mongo对数据库进行操作。身份验证由配置文件中的security.authorization控制，默认为disabled。该模式称为localhost exception，在该模式下我们对数据库有完全的控制权。</p>

        <p>首先创建一个系统Administrator,通过如下命令来完成：</p>
        <div class="commands">
        <span class="command"><span class="op">&gt;</span>./bin/mongo</span>
        <span class="command"><span class="op">&gt;</span>use admin</span>
				<span class="command"><span class="op">&gt;</span>db.createUser( { user: "admin", pwd: "123", roles: [ { role: "userAdminAnyDatabase", db: "admin" } ] } )</span>
				</div>

        <p>然后就可以退出mongo，开启配置文件里的身份验证（security.authorization）并重启mongoDB，然后以Administrator的身份登录mongo创建需要的用户。</p>
        <div class="commands">
        <span class="command"><span class="op">&gt;</span>./bin/mongo -u "admin" -p "123"</span>
				<span class="command"><span class="op">&gt;</span>db.createUser( { user: "xfoolish", pwd: "123", roles: [ "readWrite", "dbAdmin" ] } )</span>
				</div>

        <h1>MongoDB管理工具</h1>
        <p>为了方便使用，可以选择GUI管理工具来对MongoDB进行管理，简单的工具如<a href="https://github.com/andzdroid/mongo-express">mongo-express</a>，它由node.js实现，可以方便地安装和使用。也可以选择强大的<a href="http://3t.io/mongochef/">MongoChef</a>，它对非商业用途是免费的。</p>
			</div>
		</div>
	</div>
</div>
